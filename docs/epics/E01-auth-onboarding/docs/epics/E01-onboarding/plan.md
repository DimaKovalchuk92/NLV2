# E1: Onboarding & Identity - План Реалізації

## 1. Архітектурні Рішення

Цей епік закладає фундамент для всієї системи, тому архітектура має бути надійною та масштабованою.

-   **Схема Бази Даних:** Буде створено нову схему `auth_schema` в PostgreSQL для ізоляції даних автентифікації.
-   **Таблиці:**
    -   `users`: Основна таблиця з `id`, `email`, `password_hash`, `role` (`Client`, `Specialist`), `email_verified_at`.
    -   `user_profiles`: Розширена інформація про користувача (`user_id`, `full_name`, `avatar_url`, `bio`, `specializations`, `languages`, `onboarding_complete`).
    -   `user_sessions`: Для управління активними сесіями (`id`, `user_id`, `refresh_token_hash`, `ip_address`, `user_agent`, `expires_at`).
    -   `oauth_providers`: Для зв'язування акаунтів соцмереж (`user_id`, `provider` (e.g., 'google'), `provider_user_id`).
-   **Технології Backend (API):**
    -   **Фреймворк:** NestJS, з створенням `AuthModule` та `UsersModule`.
    -   **Автентифікація:** `Passport.js` буде використано для реалізації стратегій:
        -   `passport-local` (email/пароль)
        -   `passport-jwt` (для захисту ендпоінтів)
        -   `passport-google-oauth20` та `passport-apple` (для входу через соцмережі).
    -   **Безпека:**
        -   Паролі хешуватимуться за допомогою `bcrypt`.
        -   JWT токени (access та refresh) будуть підписані асиметричним ключем (RS256).
        -   Буде реалізовано механізм `Refresh Token Rotation` для підвищення безпеки.
-   **Технології Frontend (Web):**
    -   **UI:** Компоненти для форм реєстрації, входу та візарду будуть створені з використанням Tailwind CSS.
    -   **Валідація:** `Zod` буде використано для валідації форм на клієнті перед відправкою на сервер.

## 2. Зміни в `index.html`

Поточна модальна форма в `index.html` є хорошою основою, але потребує доопрацювання для відповідності специфікації.

1.  **Розділення логіки реєстрації:** Функція `handleRegister()` буде модифікована.
    -   **Для Клієнта:** Реєстрація залишається простою, як зараз. Після успішної реєстрації та входу відбувається перенаправлення до `cabinet.html`.
    -   **Для Спеціаліста ('admin'):** Після реєстрації в `MockAPI` для нього буде створено профіль з полем `onboardingComplete: false`. Після цього його буде перенаправлено до `admin.html`.
2.  **Логіка Онбординг-візарду:** Основна логіка візарду буде знаходитись на сторінці `admin.html`. При завантаженні `admin.html` скрипт перевірятиме поле `onboardingComplete`. Якщо воно `false`, замість основного дашборду буде показано інтерфейс покрокового візарду.

## 3. Зміни в `mock-api.js`

Для підтримки нового функціоналу `MockAPI` буде розширено.

1.  **Структура даних користувача:** Об'єкт користувача, що зберігається в `localStorage`, буде розширено, щоб включати профіль.

    ```javascript
    // Приклад нової структури
    const user = {
        id: 'new_specialist',
        pass: 'hashed_password',
        role: 'admin', // 'client' або 'admin'
        name: 'Ім\'я Спеціаліста',
        profile: {
            specializations: [],
            languages: [],
            onboardingComplete: false // Ключовий прапорець для візарду
        }
    };
    ```

2.  **Функція `registerUser`:** Буде оновлена для створення розширеного об'єкта користувача з порожнім профілем та прапорцем `onboardingComplete: false` для ролі `admin`.