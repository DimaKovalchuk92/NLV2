<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞ | Platform OS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style-cabinet.css">
    <style>
        /* –î–æ–¥–∞—Ç–∫–æ–≤—ñ —Å—Ç–∏–ª—ñ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –≤–∫–ª–∞–¥–æ–∫ */
        .tab-pane { display: none; animation: fadeIn 0.5s; }
        .tab-pane.active { display: block; }
        .nav-tab { cursor: pointer; transition: all 0.3s; }
        .nav-tab.active { color: #2563eb; border-bottom: 2px solid #2563eb; font-weight: bold; }
        .hidden { display: none !important; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans flex min-h-screen">

    <aside class="sidebar fixed h-screen z-50">
        <div class="logo font-black italic tracking-tighter">
            NEW LIFE <span class="text-blue-600">VISION</span>
        </div>
        <nav class="mt-12 space-y-4">
            <a href="#" class="sidebar-link active" data-target="tab-dashboard">üë• <span data-translate-key="nav_clients">–ú–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã</span></a>
            <a href="#" id="sidebar-calendar" class="sidebar-link">üìÖ <span data-translate-key="nav_calendar">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</span></a>
            <a href="#" class="sidebar-link">üß© <span data-translate-key="nav_methodology">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è</span></a>
            <a href="index.html" class="sidebar-link">üè† <span data-translate-key="nav_exit">–í—ã–π—Ç–∏</span></a>
        </nav>
        <div class="mt-auto pt-10">
            <span class="px-3 py-1 bg-slate-900 text-white text-[10px] font-bold rounded-md uppercase tracking-widest" data-translate-key="role_specialist">
                –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç
            </span>
        </div>
    </aside>

    <main class="content-area">
        <header class="header-main relative">
            <div class="user-greeting">
                <div>
                    <h1 id="specialist-name" class="text-3xl font-bold">–ü–∞–Ω–µ–ª—å –°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞</h1>
                    <p id="specialist-spec" class="text-slate-500 font-medium"></p>
                </div>
                <div id="specialist-avatar" class="avatar shadow-lg bg-slate-900 text-white flex items-center justify-center text-xl font-bold rounded-full w-12 h-12">S</div>
            </div>
            <div id="session-id-display" class="absolute top-4 right-6 text-[10px] text-slate-400 uppercase tracking-widest"></div>
        </header>

        <nav class="nav-tabs-container flex gap-6 border-b border-slate-200 mb-8 px-8" role="tablist">
            <div class="nav-tab active pb-4" data-target="tab-dashboard" data-translate-key="tab_dashboard">–î–∞—à–±–æ—Ä–¥</div>
            <div class="nav-tab pb-4" data-target="tab-cases" data-translate-key="tab_cases">–ö–µ–π—Å—ã</div>
            <div class="nav-tab pb-4" data-target="tab-marketplace" data-translate-key="tab_marketplace">–ú–∞—Ä–∫–µ—Ç–ø–ª–µ–π—Å</div>
            <div class="nav-tab pb-4" data-target="tab-finance" data-translate-key="tab_finance">–§–∏–Ω–∞–Ω—Å—ã</div>
            <div class="nav-tab pb-4" data-target="tab-schedule" data-translate-key="tab_schedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</div>
            <div class="nav-tab pb-4 text-slate-400" data-action="open-settings" data-translate-key="tab_settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</div>
        </nav>

        <div class="tab-content px-8">
            <section id="tab-dashboard" class="tab-pane active">
                <h2 class="text-2xl font-bold mb-8" data-translate-key="dashboard_title">–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã (Case Engine)</h2>
                <div id="cases-list" class="grid grid-cols-1 gap-4"></div>
            </section>

            <section id="tab-cases" class="tab-pane">
                <h2 class="text-2xl font-bold mb-6" data-translate-key="tab_cases">–ö–µ–π—Å—ã</h2>
                <p class="text-slate-500">–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∫–µ–π—Å–æ–≤.</p>
            </section>

            <section id="tab-schedule" class="tab-pane">
                <h2 class="text-2xl font-bold mb-6" data-translate-key="tab_schedule">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h2>
                <div class="mb-4">
                    <label class="text-sm text-slate-600"><span data-translate-key="schedule_select_date">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É:</span>
                        <input id="schedule-date" type="date" class="ml-2 px-3 py-2 border rounded">
                    </label>
                </div>
                <div id="schedule-list" class="space-y-4"></div>
            </section>

            </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ù–∞—Å—Ç—Ä–æ–µ–∫ -->
    <div id="admin-settings-modal" class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm z-[200] hidden items-center justify-center p-4">
        <div class="bg-white rounded-3xl p-8 w-full max-w-2xl shadow-2xl relative max-h-[90vh] overflow-y-auto">
            <button onclick="closeAdminSettingsModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-500 hover:text-red-500 transition">‚úï</button>
            
            <h2 class="text-2xl font-bold mb-8" data-translate-key="settings_title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã</h2>
            
            <!-- Profile Section -->
            <div class="p-6 mb-8 border border-slate-200 rounded-2xl">
                <h3 class="font-bold mb-4" data-translate-key="settings_profile_title">–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å</h3>
                <p id="profile-display-name" class="text-lg font-bold"></p>
                <p id="profile-display-spec" class="text-slate-500"></p>
                <p id="profile-display-bio" class="text-sm text-slate-600 mt-4"></p>
                <p id="profile-display-welcome" class="text-sm text-slate-600 mt-2 italic p-3 bg-slate-50 rounded-lg"></p>
            </div>

            <!-- Appearance Section -->
            <div class="p-6 mb-8 border border-slate-200 rounded-2xl">
                <h3 class="text-xl font-bold mb-6" data-translate-key="settings_appearance">–í–Ω–µ—à–Ω–∏–π –≤–∏–¥</h3>
                <div class="flex gap-4">
                    <button id="theme-btn-light" onclick="setTheme('light')" class="flex-1 py-4 border-2 border-slate-100 rounded-2xl font-bold hover:border-blue-500 focus:border-blue-600 transition flex flex-col items-center gap-2">
                        <span class="text-2xl">‚òÄÔ∏è</span> <span data-translate-key="settings_theme_light">–°–≤–µ—Ç–ª–∞—è</span>
                    </button>
                    <button id="theme-btn-dark" onclick="setTheme('dark')" class="flex-1 py-4 border-2 border-slate-100 rounded-2xl font-bold hover:border-blue-500 focus:border-blue-600 transition flex flex-col items-center gap-2">
                        <span class="text-2xl">üåô</span> <span data-translate-key="settings_theme_dark">–¢–µ–º–Ω–∞—è</span>
                    </button>
                </div>
            </div>

            <!-- Language Section -->
            <div class="p-6 mb-8 border border-slate-200 rounded-2xl">
                <h3 class="text-xl font-bold mb-6" data-translate-key="settings_language">–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</h3>
                <div class="space-y-4">
                    <label class="flex items-center gap-4 p-4 border border-slate-100 rounded-xl cursor-pointer hover:bg-slate-50 transition">
                        <input type="radio" name="lang" value="ru" onchange="setLanguage('ru')" class="w-5 h-5 text-blue-600">
                        <span class="font-bold" data-translate-key="lang_ru">–†—É—Å—Å–∫–∏–π</span>
                    </label>
                    <label class="flex items-center gap-4 p-4 border border-slate-100 rounded-xl cursor-pointer hover:bg-slate-50 transition">
                        <input type="radio" name="lang" value="ua" onchange="setLanguage('ua')" class="w-5 h-5 text-blue-600">
                        <span class="font-bold" data-translate-key="lang_ua">–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</span>
                    </label>
                    <label class="flex items-center gap-4 p-4 border border-slate-100 rounded-xl cursor-pointer hover:bg-slate-50 transition">
                        <input type="radio" name="lang" value="en" onchange="setLanguage('en')" class="w-5 h-5 text-blue-600">
                        <span class="font-bold" data-translate-key="lang_en">English</span>
                    </label>
                </div>
            </div>

            <!-- Danger Zone -->
            <div class="mt-8 bg-red-50 p-6 rounded-2xl border border-red-200">
                <h3 class="text-xl font-bold mb-2 text-red-800" data-translate-key="settings_delete_account_title">–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞</h3>
                <p class="text-red-600 mb-6" data-translate-key="settings_delete_account_desc">–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è –∫–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.</p>
                <button onclick="handleAccountDeletion()" class="bg-red-600 text-white px-6 py-3 rounded-xl font-bold shadow-lg hover:bg-red-700 transition" data-translate-key="settings_delete_account_btn">–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            </div>
        </div>
    </div>

    <script src="config.js"></script>
    <script src="modules/mock-api.js"></script>
    <script>
        // --- 1. –î–∞–Ω–Ω—ã–µ –∏ –ü–µ—Ä–µ–≤–æ–¥—ã ---
        const translations = {
            ru: {
                tab_dashboard: '–î–∞—à–±–æ—Ä–¥', tab_cases: '–ö–µ–π—Å—ã', tab_schedule: '–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ',
                tab_settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã', dashboard_title: '–ê–∫—Ç–∏–≤–Ω—ã–µ –∫–µ–π—Å—ã (Case Engine)',
                nav_clients: '–ú–æ–∏ –∫–ª–∏–µ–Ω—Ç—ã', nav_calendar: '–ö–∞–ª–µ–Ω–¥–∞—Ä—å', nav_exit: '–í—ã–π—Ç–∏', role_specialist: '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç',
                settings_title: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã', settings_profile_title: '–ú–æ–π –ø—Ä–æ—Ñ–∏–ª—å',
                settings_appearance: '–í–Ω–µ—à–Ω–∏–π –≤–∏–¥', settings_theme_light: '–°–≤–µ—Ç–ª–∞—è', settings_theme_dark: '–¢–µ–º–Ω–∞—è',
                settings_language: '–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞', lang_ru: '–†—É—Å—Å–∫–∏–π', lang_ua: '–£–∫—Ä–∞—ó–Ω—Å—å–∫–∞', lang_en: 'English',
                settings_delete_account_title: '–£–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞',
                settings_delete_account_desc: '–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ. –í—Å–µ –≤–∞—à–∏ –¥–∞–Ω–Ω—ã–µ, –≤–∫–ª—é—á–∞—è –∫–µ–π—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã.',
                settings_delete_account_btn: '–£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç'
            },
            ua: {
                tab_dashboard: '–î–∞—à–±–æ—Ä–¥', tab_cases: '–ö–µ–π—Å–∏', tab_schedule: '–†–æ–∑–∫–ª–∞–¥',
                tab_settings: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è', dashboard_title: '–ê–∫—Ç–∏–≤–Ω—ñ –∫–µ–π—Å–∏', role_specialist: '–°–ø–µ—Ü—ñ–∞–ª—ñ—Å—Ç',
                nav_clients: '–ú–æ—ó –∫–ª—ñ—î–Ω—Ç–∏', nav_calendar: '–ö–∞–ª–µ–Ω–¥–∞—Ä', nav_exit: '–í–∏–π—Ç–∏',
                settings_title: '–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è', settings_profile_title: '–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å'
            },
            en: {
                tab_dashboard: 'Dashboard', tab_cases: 'Cases', tab_schedule: 'Schedule',
                tab_settings: 'Settings', dashboard_title: 'Active Cases (Case Engine)', role_specialist: 'Specialist',
                nav_clients: 'My Clients', nav_calendar: 'Calendar', nav_exit: 'Exit'
            }
        };

        // --- 2. –§—É–Ω–∫—Ü–∏–∏ UI ---
        function applyTranslations() {
            const lang = localStorage.getItem('appLang') || 'ru';
            const dict = translations[lang] || translations.ru;
            document.querySelectorAll('[data-translate-key]').forEach(el => {
                const key = el.getAttribute('data-translate-key');
                if (dict[key]) el.innerText = dict[key];
            });
        }

        function switchTab(targetId) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            const activeTab = document.querySelector(`[data-target="${targetId}"]`);
            if (activeTab) activeTab.classList.add('active');

            document.querySelectorAll('.tab-pane').forEach(p => p.classList.remove('active')); // –°–Ω–∞—á–∞–ª–∞ —Å–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ
            const targetPane = document.getElementById(targetId);
            if (targetPane) targetPane.classList.add('active'); // –ó–∞—Ç–µ–º –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é

            // –ï—Å–ª–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –µ–µ
            if (targetId === 'tab-schedule') {
                const dateInput = document.getElementById('schedule-date');
                if (dateInput) {
                    if (!dateInput.value) {
                        dateInput.value = new Date().toISOString().split('T')[0];
                    }
                    renderSchedule(dateInput.value);
                }
            }
        }

        function openAdminSettingsModal() {
            const modal = document.getElementById('admin-settings-modal');
            modal.classList.remove('hidden');
            loadSpecialistProfile(); // Ensure profile data is fresh
            modal.classList.add('flex');
            const currentLang = localStorage.getItem('appLang') || 'ru';
            document.querySelector(`input[name="lang"][value="${currentLang}"]`).checked = true;
            const currentTheme = localStorage.getItem('appTheme') || 'light';
            updateThemeButtons(currentTheme);
        }

        function closeAdminSettingsModal() {
            const modal = document.getElementById('admin-settings-modal');
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        function loadSpecialistProfile() {
            const user = MockAPI.getLoggedInUser();
            if (!user || !user.profile) return;
            document.getElementById('specialist-name').innerText = user.profile.fullName || '–°–ø–µ—Ü–∏–∞–ª–∏—Å—Ç';
            document.getElementById('specialist-spec').innerText = user.profile.specializations?.[0] || '';
            document.getElementById('profile-display-name').innerText = user.profile.fullName;
            document.getElementById('profile-display-spec').innerText = user.profile.specializations?.join(', ');
            document.getElementById('profile-display-bio').innerText = user.profile.bio || '';
            document.getElementById('profile-display-welcome').innerText = user.profile.welcomeMessage ? `"${user.profile.welcomeMessage}"` : '';
            const avatar = document.getElementById('specialist-avatar');
            if (avatar) avatar.innerText = user.profile.fullName ? user.profile.fullName.charAt(0) : 'S';
        }

        function setLanguage(lang) {
            localStorage.setItem('appLang', lang);
            applyTranslations();
        }

        function setTheme(theme) {
            localStorage.setItem('appTheme', theme);
            document.body.classList.toggle('dark-theme', theme === 'dark');
            updateThemeButtons(theme);
        }

        function updateThemeButtons(theme) {
            const lightBtn = document.getElementById('theme-btn-light');
            const darkBtn = document.getElementById('theme-btn-dark');
            if (!lightBtn || !darkBtn) return;
            lightBtn.classList.remove('border-blue-600', 'border-2');
            darkBtn.classList.remove('border-blue-600', 'border-2');
            (theme === 'dark' ? darkBtn : lightBtn).classList.add('border-blue-600', 'border-2');
        }

        function handleAccountDeletion() {
            if (confirm(translations[localStorage.getItem('appLang') || 'ru'].settings_delete_account_desc)) {
                const user = MockAPI.getLoggedInUser();
                if (user) {
                    MockAPI.deleteUser(user.id);
                    alert("–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –±—ã–ª —É–¥–∞–ª–µ–Ω.");
                    window.location.href = 'index.html';
                }
            }
        }

        function renderCases() {
            const user = MockAPI.getLoggedInUser();
            if (!user) return;
            const cases = MockAPI.getCasesForSpecialist(user.id);
            const casesListEl = document.getElementById('cases-list');
            if (!casesListEl) return;

            if (!cases || cases.length === 0) {
                casesListEl.innerHTML = `<p class="text-slate-500">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–µ–π—Å–æ–≤.</p>`;
                return;
            }

            const statusMap = { active: { text: '–ê–∫—Ç–∏–≤–µ–Ω', color: 'bg-green-100 text-green-800' }, paused: { text: '–ù–∞ –ø–∞—É–∑–µ', color: 'bg-yellow-100 text-yellow-800' }, closing: { text: '–ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è', color: 'bg-blue-100 text-blue-800' }, archived: { text: '–í –∞—Ä—Ö–∏–≤–µ', color: 'bg-slate-100 text-slate-800' } };

            casesListEl.innerHTML = cases.map(caseItem => `
                <div class="activity-card flex justify-between items-center p-4" data-case-id="${caseItem.id}">
                    <div class="flex-1">
                        <h3 class="font-bold text-lg text-slate-800">${caseItem.clientName}</h3>
                        <p class="text-sm text-slate-500">${caseItem.programName}</p>
                        <p class="text-xs text-slate-400 mt-2">–ü–æ—Å–ª–µ–¥–Ω—è—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: ${new Date(caseItem.lastActivity).toLocaleDateString()}</p>
                    </div>
                    <div class="actions status-wrap">
                        <button class="status-btn" data-action="toggle-status-menu"><span class="w-3 h-3 rounded-full ${statusMap[caseItem.status]?.color || ''}"></span><strong>${statusMap[caseItem.status]?.text || caseItem.status}</strong><svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></button>
                        <div class="status-menu hidden">${Object.keys(statusMap).map(s => `<a href="#" class="status-item" data-status="${s}">${statusMap[s].text}</a>`).join('')}</div>
                    </div>
                </div>
            `).join('');
        }

        function renderSchedule(selectedDate) {
            const user = MockAPI.getLoggedInUser();
            if (!user) return;
            const scheduleListEl = document.getElementById('schedule-list');
            if (!scheduleListEl) return;

            const allAppointments = MockAPI.getScheduleForSpecialist(user.id);
            const appointmentsForDate = allAppointments.filter(appt => appt.date === selectedDate);

            if (appointmentsForDate.length === 0) {
                scheduleListEl.innerHTML = `<p class="text-slate-500">–ù–∞ —ç—Ç—É –¥–∞—Ç—É –Ω–µ—Ç –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–µ—Å—Å–∏–π.</p>`;
                return;
            }

            scheduleListEl.innerHTML = appointmentsForDate.sort((a, b) => a.time.localeCompare(b.time)).map(appt => `
                <div class="activity-card flex justify-between items-center p-4">
                    <div class="flex items-center gap-4">
                        <div class="text-lg font-bold text-slate-700">${appt.time}</div>
                        <div>
                            <h3 class="font-bold text-lg text-slate-800">${appt.clientName}</h3>
                            <p class="text-sm text-slate-500">${appt.type} (${appt.duration} –º–∏–Ω)</p>
                        </div>
                    </div>
                    <div class="actions">
                        <button class="px-4 py-2 bg-blue-100 text-blue-700 rounded-lg font-bold text-sm">–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è</button>
                    </div>
                </div>
            `).join('');
        }

        // --- 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ---
        document.addEventListener('DOMContentLoaded', () => {
            MockAPI.init();
            const user = MockAPI.getLoggedInUser();

            // Guard: –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ä–æ–ª—å –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.
            if (!user || user.role !== 'admin') {
                window.location.href = 'index.html';
                return;
            }

            // --- –®–∞–≥ 1: –ü—Ä–∏–≤—è–∑–∫–∞ –≤—Å–µ—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π ---
            document.querySelector('.nav-tabs-container').addEventListener('click', (e) => {
                const tab = e.target.closest('.nav-tab');
                if (!tab) return;
                if (tab.dataset.action === 'open-settings') openAdminSettingsModal();
                else if (tab.dataset.target) switchTab(tab.dataset.target);
            });

            document.getElementById('sidebar-calendar')?.addEventListener('click', (e) => {
                e.preventDefault();
                switchTab('tab-schedule');
            });

            const scheduleDateInput = document.getElementById('schedule-date');
            if (scheduleDateInput) {
                scheduleDateInput.addEventListener('change', () => renderSchedule(scheduleDateInput.value));
            }

            document.getElementById('cases-list').addEventListener('click', function(e) {
                const toggleBtn = e.target.closest('[data-action="toggle-status-menu"]');
                const statusItem = e.target.closest('.status-item');

                document.querySelectorAll('.status-menu').forEach(menu => {
                    if (!toggleBtn || !menu.isSameNode(toggleBtn.nextElementSibling)) menu.classList.add('hidden');
                });

                if (toggleBtn) {
                    e.preventDefault();
                    toggleBtn.nextElementSibling.classList.toggle('hidden');
                }

                if (statusItem) {
                    e.preventDefault();
                    MockAPI.updateCase(statusItem.closest('.activity-card').dataset.caseId, { status: statusItem.dataset.status });
                    renderCases();
                }
            });

            // --- –®–∞–≥ 2: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ UI ---
            applyTranslations();
            const savedTheme = localStorage.getItem('appTheme') || 'light';
            setTheme(savedTheme);
            const sessionDisplay = document.getElementById('session-id-display');
            if (user.activeSessions?.length > 0) {
                sessionDisplay.innerText = `SID: ${user.activeSessions[user.activeSessions.length - 1].sessionId}`;
            }

            // --- –®–∞–≥ 3: –£—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ (–ú–∞—Å—Ç–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–ª–∏ –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è) ---
            if (user.profile && user.profile.onboardingComplete === false) {
                showOnboardingWizard();
            } else {
                // The user is fully onboarded, load the main interface.
                loadSpecialistProfile();
                renderCases();
                switchTab('tab-dashboard');
            }
        });
    </script>
</body>
</html>