<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Life Vision | –ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        :root { --brand-grad: linear-gradient(to right, #3b82f6, #10b981, #facc15); }

        .btn-grow {
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer !important;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 50;
        }
        .btn-grow:hover { transform: scale(1.05); }

        @keyframes breathe {
            0%, 100% { transform: scale(0.8); opacity: 0.4; }
            40%, 60% { transform: scale(1.4); opacity: 1; }
        }
        @keyframes textCycle {
            0%, 100% { content: "–í—ã–¥–æ—Ö..."; color: #64748b; }
            5%, 35% { content: "–í–¥–æ—Ö..."; color: #3b82f6; }
            40%, 65% { content: "–ó–∞–¥–µ—Ä–∂–∏—Ç–µ..."; color: #10b981; }
        }
        .breath-hint::after { content: "–î—ã—à–∏—Ç–µ..."; animation: textCycle 8s infinite; }
        .breath-circle {
            width: 200px; height: 200px; border-radius: 50%;
            background: radial-gradient(circle, #3b82f6 0%, #93c5fd 100%);
            animation: breathe 8s infinite ease-in-out;
            box-shadow: 0 0 60px rgba(59, 130, 246, 0.3);
        }

        .auth-modal {
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity .28s ease, visibility .28s ease;
        }
        .auth-modal .modal-window {
            transform: translateY(12px) scale(.98);
            transition: transform .32s cubic-bezier(.2,.9,.2,1), opacity .28s ease;
            opacity: 0;
        }
        .auth-modal.open {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }
        .auth-modal.open .modal-window {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 font-sans min-h-screen overflow-x-hidden">

    <nav class="flex justify-between items-center p-8 max-w-7xl mx-auto">
        <div class="text-2xl font-black italic tracking-tighter">
            NEW LIFE <span class="text-blue-600">VISION</span>
        </div>
        <button class="bg-blue-600 text-white px-8 py-3 rounded-full font-bold btn-grow shadow-lg">–ù–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</button>
    </nav>

    <header class="max-w-7xl mx-auto px-6 py-24 text-center">
        <h1 class="text-7xl font-black mb-8 leading-tight tracking-tight">New Life Vision</h1>
        <p class="text-xl text-slate-500 max-w-2xl mx-auto mb-12">
            –û–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –æ–Ω–ª–∞–π–Ω-–ø—Ä–∞–∫—Ç–∏–∫–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–æ–≤ –ø–æ–º–æ–≥–∞—é—â–∏—Ö –ø—Ä–æ—Ñ–µ—Å—Å–∏–π. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å.
        </p>
        
        <div id="auth-buttons" class="flex flex-col md:flex-row justify-center gap-6 relative z-10">
            <button onclick="openAuth('client')" class="btn-grow bg-white border border-slate-200 px-10 py-5 rounded-2xl shadow-sm font-bold text-lg text-slate-900">
                üîç –ù–∞–π—Ç–∏ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞
            </button>
            <button onclick="openAuth('admin')" class="btn-grow bg-slate-900 text-white px-10 py-5 rounded-2xl shadow-xl font-bold text-lg">
                üöÄ –Ø –ø—Ä–æ—Ñ–∏
            </button>
        </div>
    </header>

    <section class="max-w-6xl mx-auto px-6 grid grid-cols-1 md:grid-cols-3 gap-10 pb-32">
        <div class="format-card p-10 border border-slate-100">
            <div class="w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center text-4xl mb-8">üë§</div>
            <h3 class="text-2xl font-bold mb-4">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ</h3>
            <p class="text-slate-500 text-lg">–†–∞–±–æ—Ç–∞ 1:1 —Å –ø–æ–ª–Ω–æ–π –∏—Å—Ç–æ—Ä–∏–µ–π —Å–µ—Å—Å–∏–π –∏ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —á–∞—Ç–æ–º.</p>
        </div>
        <div class="format-card p-10 border border-slate-100">
            <div class="w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center text-4xl mb-8">üë•</div>
            <h3 class="text-2xl font-bold mb-4">–ì—Ä—É–ø–ø–æ–≤–∞—è —Ç–µ—Ä–∞–ø–∏—è</h3>
            <p class="text-slate-500 text-lg">–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–±—â–µ–≥–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≥—Ä—É–ø–ø—ã –∏ –ª–∏—á–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.</p>
        </div>
        <div class="format-card p-10 border border-slate-100">
            <div class="w-16 h-16 bg-slate-50 rounded-2xl flex items-center justify-center text-4xl mb-8">üèÜ</div>
            <h3 class="text-2xl font-bold mb-4">–ú–∞—Ä–∞—Ñ–æ–Ω—ã</h3>
            <p class="text-slate-500 text-lg">–ü—Ä–æ–≥—Ä–∞–º–º—ã —Å –≥–µ–π–º–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ –ü—É—Ç—å –≥–µ—Ä–æ—è.</p>
        </div>
    </section>

    <button onclick="document.getElementById('g').style.display='flex'" class="fixed bottom-10 right-10 bg-red-500 text-white w-20 h-20 rounded-full shadow-2xl flex items-center justify-center text-4xl z-50 hover:scale-110 transition-transform">üßò‚Äç‚ôÇÔ∏è</button>

    <div id="g" style="display:none;" class="fixed inset-0 bg-white/98 backdrop-blur-2xl z-[100] flex-col items-center justify-center text-center">
        <h2 class="breath-hint text-5xl font-black mb-16 h-16"></h2>
        <div class="breath-circle mb-16 mx-auto"></div>
        <button onclick="document.getElementById('g').style.display='none'" class="btn-grow bg-slate-100 text-slate-500 px-10 py-4 rounded-full font-bold uppercase tracking-widest text-sm hover:text-red-500">–ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>

    <div id="auth-modal" class="auth-modal fixed inset-0 bg-slate-900/40 backdrop-blur-md z-[150] items-center justify-center p-4" aria-hidden="true">
        <div class="modal-window bg-white w-full max-w-md rounded-[2.5rem] p-10 shadow-2xl max-h-[90vh] overflow-y-auto">
            <h2 id="modal-title" class="text-3xl font-black mb-2">–í—Ö–æ–¥</h2>
            <p id="modal-desc" class="text-slate-500 mb-8 text-sm italic">–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –≤ New Life Vision</p>
            <div id="auth-flow-container">
                <!-- Step 0: Login/Register Form -->
                <div id="auth-step-form">
                    <div class="space-y-4 text-left">
                        <input type="text" id="name" class="hidden w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–í–∞—à–µ –∏–º—è">
                        <input type="email" id="email" class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–í–∞—à Email">
                        <input type="password" id="password" class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–ü–∞—Ä–æ–ª—å (–º–∏–Ω. 10 —Å–∏–º–≤–æ–ª–æ–≤)">
                        <input type="password" id="password-confirm" class="hidden w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                        <div id="specialist-fields" class="hidden space-y-4 pt-4 border-t border-slate-200 mt-4">
                            <div>
                                <label class="block text-sm font-bold text-slate-500 mb-2">–í–∞—à–∞ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è</label>
                                <input type="text" id="specialization" class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–ù–∞–ø—Ä. –ü—Å–∏—Ö–æ–ª–æ–≥">
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 mb-2">–ü—Ä–æ —Å–µ–±–µ</label>
                                <textarea id="bio" class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–î–æ—Å–≤—ñ–¥ —Ä–æ–±–æ—Ç–∏" rows="3"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-slate-500 mb-2">–í—ñ—Ç–∞–ª—å–Ω–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è</label>
                                <textarea id="welcomeMessage" class="w-full px-6 py-4 bg-slate-50 border border-slate-100 rounded-2xl focus:border-blue-500 outline-none" placeholder="–ü—Ä–∏–≤—ñ—Ç –∫–ª—ñ—î–Ω—Ç—É" rows="3"></textarea>
                            </div>
                        </div>
                    </div>
                    <div id="consent-fields" class="hidden mt-6 space-y-3 text-left">
                        <label class="flex items-start gap-3 cursor-pointer text-sm text-slate-600">
                            <input type="checkbox" id="terms-consent" onchange="checkConsents()" class="mt-1 h-4 w-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500">
                            <span>–Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å <a href="#" class="font-bold text-blue-600 hover:underline">–£—Å–ª–æ–≤–∏—è–º–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</a> –∏ <a href="#" class="font-bold text-blue-600 hover:underline">–ü–æ–ª–∏—Ç–∏–∫–æ–π –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏</a>.</span>
                        </label>
                        <label class="flex items-start gap-3 cursor-pointer text-sm text-slate-600">
                            <input type="checkbox" id="data-consent" onchange="checkConsents()" class="mt-1 h-4 w-4 text-blue-600 border-slate-300 rounded focus:ring-blue-500">
                            <span>–Ø –¥–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ <a href="#" class="font-bold text-blue-600 hover:underline">–û–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö</a> —Å–æ–≥–ª–∞—Å–Ω–æ GDPR/HIPAA.</span>
                        </label>
                    </div>
                    <div id="oauth-section" class="mt-6 text-center">
                        <div class="relative flex py-2 items-center">
                            <div class="flex-grow border-t border-slate-200"></div>
                            <span class="flex-shrink mx-4 text-xs text-slate-400 uppercase font-bold">–ò–ª–∏ –≤–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑</span>
                            <div class="flex-grow border-t border-slate-200"></div>
                        </div>
                        <div class="mt-4 grid grid-cols-3 gap-3">
                            <button onclick="handleOAuthLogin('Google')" class="w-full inline-flex justify-center py-3 px-4 border border-slate-200 rounded-xl shadow-sm bg-white text-sm font-medium text-slate-500 hover:bg-slate-50">
                                <span class="sr-only">Sign in with Google</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" /><path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" /><path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l3.66-2.84z" /><path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" /></svg>
                            </button>
                            <button onclick="handleOAuthLogin('Apple')" class="w-full inline-flex justify-center py-3 px-4 border border-slate-200 rounded-xl shadow-sm bg-white text-sm font-medium text-slate-500 hover:bg-slate-50">
                                <span class="sr-only">Sign in with Apple</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><path d="M12.012 15.381c-.89 0-1.78-.28-2.55-.84l-.1-.06c-1.39-.93-2.43-2.4-2.43-4.04 0-1.02.5-2.04 1.2-2.74.7-.7 1.68-1.12 2.78-1.12 1.01 0 1.9.36 2.6.98.15.13.3.26.44.4.08.08.16.15.25.23.68.61 1.11 1.44 1.11 2.34 0 1.9-1.44 3.33-1.53 3.43-.45.55-1.02.82-1.67.82zm5.4-3.33c.04-2.34-1.6-4.1-3.64-4.1-1.95 0-3.74 1.5-4.72 1.5-.98 0-2.48-1.4-4.24-1.4-2.28 0-4.29 1.8-4.29 4.37 0 2.64 1.8 5.23 4.2 5.23 1.03 0 2.03-.52 2.73-1.32.89.82 2.05 1.32 3.33 1.32 2.33 0 4.15-1.9 4.24-4.08z"/></svg>
                            </button>
                            <button onclick="handleOAuthLogin('Facebook')" class="w-full inline-flex justify-center py-3 px-4 border border-slate-200 rounded-xl shadow-sm bg-white text-sm font-medium text-slate-500 hover:bg-slate-50">
                                <span class="sr-only">Sign in with Facebook</span>
                                <svg class="w-5 h-5" aria-hidden="true" fill="currentColor" viewBox="0 0 24 24"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991 3.657 9.128 8.438 9.878v-6.987h-2.54V12h2.54V9.797c0-2.506 1.492-3.89 3.777-3.89 1.094 0 2.238.195 2.238.195v2.46h-1.26c-1.243 0-1.63.771-1.63 1.562V12h2.773l-.443 2.89h-2.33v6.988C18.343 21.128 22 16.991 22 12z" /></svg>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Onboarding Wizard -->
                <div id="auth-step-onboarding" class="hidden">
                    <div class="flex justify-between items-start mb-6">
                        <div>
                            <h2 id="wizard-title" class="text-2xl font-bold">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è</h2>
                            <p id="wizard-step-indicator" class="text-sm text-slate-500 font-medium">–®–∞–≥ 1 –∏–∑ 4</p>
                        </div>
                        <a href="#" onclick="finalRegister(true, event)" class="text-sm text-slate-500 hover:text-blue-600 flex-shrink-0 ml-4">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫—É</a>
                    </div>
                    <div id="wizard-steps-container" class="min-h-[250px]">
                        <div id="wizard-step-1" class="wizard-step-pane space-y-4">
                            <p class="text-slate-600 text-sm">–≠—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –±—É–¥–µ—Ç –≤–∏–¥–Ω–∞ –≤–∞—à–∏–º –∫–ª–∏–µ–Ω—Ç–∞–º.</p>
                            <input type="text" id="wizard-fullName" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è">
                            <input type="text" id="wizard-specializations" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg" placeholder="–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)">
                            <textarea id="wizard-bio" class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-lg" rows="4" placeholder="–û —Å–µ–±–µ (–±–∏–æ)"></textarea>
                        </div>
                        <div id="wizard-step-2" class="wizard-step-pane hidden"><p class="text-center text-slate-400 italic py-10">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è.</p></div>
                        <div id="wizard-step-3" class="wizard-step-pane hidden"><p class="text-center text-slate-400 italic py-10">–ó–¥–µ—Å—å –±—É–¥–µ—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–µ–π.</p></div>
                        <div id="wizard-step-4" class="wizard-step-pane hidden"><div class="text-center py-10"><div class="text-5xl mb-4">üéâ</div><h3 class="font-bold text-2xl">–í—Å—ë –≥–æ—Ç–æ–≤–æ!</h3></div></div>
                    </div>
                    <div class="mt-8 pt-6 border-t border-slate-200 flex justify-between items-center">
                        <button id="wizard-prev-btn" onclick="navigateWizard(-1)" class="py-2 px-5 font-bold text-slate-500 hover:bg-slate-100 rounded-lg">–ù–∞–∑–∞–¥</button>
                        <button id="wizard-next-btn" onclick="navigateWizard(1)" class="bg-blue-600 text-white py-3 px-8 rounded-xl font-bold">–î–∞–ª–µ–µ</button>
                    </div>
                </div>
            </div>

            <div class="mt-8 flex gap-4">
                <button onclick="closeAuth()" class="flex-1 py-4 font-bold text-slate-400">–û—Ç–º–µ–Ω–∞</button>
                <button onclick="handleLogin()" id="login-btn" class="flex-1 bg-blue-600 text-white py-4 rounded-2xl font-bold shadow-lg transition-colors">–í–æ–π—Ç–∏</button>
                <button id="register-btn" class="hidden flex-1 bg-slate-400 text-white py-4 rounded-2xl font-bold shadow-lg transition-colors cursor-not-allowed" disabled>–î–∞–ª–µ–µ</button>
            </div>
            <div class="mt-4 text-center">
                <a href="#" onclick="toggleAuthMode(event)" id="auth-mode-toggle" class="text-sm font-bold text-blue-600 hover:underline">–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</a>
            </div>
        </div>
    </div>

    <script src="modules/mock-api.js"></script>
    <script>
        let currentRole = '';
        let isRegisterMode = false;
        let tempRegistrationData = {};
        let currentWizardStep = 1;

        function handleOAuthLogin(provider) {
            alert(`–í—Ö–æ–¥ —á–µ—Ä–µ–∑ ${provider} –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –≤–µ—Ä—Å–∏—è—Ö.`);
        }

        function checkConsents() {
            const terms = document.getElementById('terms-consent').checked;
            const data = document.getElementById('data-consent').checked;
            const registerBtn = document.getElementById('register-btn');

            if (terms && data) {
                registerBtn.disabled = false;
                registerBtn.classList.remove('bg-slate-400', 'cursor-not-allowed');
                registerBtn.classList.add('bg-blue-600');
            } else {
                registerBtn.disabled = true;
                registerBtn.classList.add('bg-slate-400', 'cursor-not-allowed');
                registerBtn.classList.remove('bg-blue-600');
            }
        }

        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å–µ—Å—ñ—ó –∑–≥—ñ–¥–Ω–æ –∑ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–æ—é (Session Management)
        function checkAuth() {
            const user = MockAPI.getLoggedInUser();
            const authButtons = document.getElementById('auth-buttons');
            
            if (user && authButtons) {
                const targetPage = user.role === 'admin' ? 'admin.html' : 'cabinet.html';
                // –í–∏–≤–æ–¥–∏–º–æ ID –æ—Å—Ç–∞–Ω–Ω—å–æ—ó —Å–µ—Å—ñ—ó –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è —Ä–æ–±–æ—Ç–∏ Session Management
                const lastSession = user.activeSessions && user.activeSessions.length > 0 
                    ? user.activeSessions[user.activeSessions.length - 1].sessionId 
                    : 'Active';

                authButtons.innerHTML = `
                    <div class="flex flex-col items-center gap-4">
                        <a href="${targetPage}" class="btn-grow bg-blue-600 text-white px-10 py-5 rounded-2xl shadow-xl font-bold text-lg no-underline">
                            –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∫–∞–±–∏–Ω–µ—Ç ‚Üí
                        </a>
                        <div class="text-[10px] text-slate-400 uppercase tracking-widest">Session ID: ${lastSession}</div>
                        <button onclick="logout()" class="text-slate-400 font-bold hover:text-red-500 transition">–í—ã–π—Ç–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã</button>
                    </div>
                `;
            }
        }

        function openAuth(role) {
            currentRole = role;
            isRegisterMode = false;
            
            const modal = document.getElementById('auth-modal');
            const title = document.getElementById('modal-title');
            const nameInput = document.getElementById('name');
            const emailInput = document.getElementById('email');
            const passConfirmInput = document.getElementById('password-confirm');
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const toggleLink = document.getElementById('auth-mode-toggle');
            const specialistFields = document.getElementById('specialist-fields');
            const consentFields = document.getElementById('consent-fields');
            const authForm = document.getElementById('auth-step-form');
            const onboardingWizard = document.getElementById('auth-step-onboarding');
            const oauthSection = document.getElementById('oauth-section');
            
            title.innerText = role === 'admin' ? "–í—Ö–æ–¥ –¥–ª—è –ü–†–û–§–ò" : "–í—Ö–æ–¥ –¥–ª—è –ö–õ–ò–ï–ù–¢–ê";
            nameInput.classList.add('hidden');
            passConfirmInput.classList.add('hidden');
            emailInput.placeholder = '–í–∞—à Email';
            loginBtn.classList.remove('hidden');
            registerBtn.classList.add('hidden');
            toggleLink.innerText = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
            specialistFields.classList.add('hidden');
            consentFields.classList.add('hidden');
            authForm.classList.remove('hidden');
            onboardingWizard.classList.add('hidden');
            oauthSection.classList.remove('hidden'); // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∫–Ω–æ–ø–æ–∫ —Å–æ—Ü—Å–µ—Ç–µ–π

            modal.classList.add('open');
        }

        function closeAuth() {
            document.getElementById('auth-modal').classList.remove('open');
        }

        // –í—Ö—ñ–¥ –∑ –æ–±—Ä–æ–±–∫–æ—é Rate Limiting —Ç–∞ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è–º–∏ –ø—Ä–æ –±–ª–æ–∫—É–≤–∞–Ω–Ω—è
        function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value.trim();

            if (!email || !pass) {
                alert("–í–≤–µ–¥–∏—Ç–µ email –∏ –ø–∞—Ä–æ–ª—å");
                return;
            }

            const result = MockAPI.loginUser(email, pass);

            if (result && !result.error) {
                if (result.role !== currentRole) {
                    alert(`–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Ö–æ–¥ –¥–ª—è ${result.role === 'admin' ? '–ü–†–û–§–ò' : '–ö–õ–ò–ï–ù–¢–ê'}.`);
                    return;
                }
                window.location.href = result.role === 'admin' ? 'admin.html' : 'cabinet.html';
            } else if (result && result.error === 'account_locked') {
                alert(`–ê–∫–∫–∞—É–Ω—Ç –≤—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —á–µ—Ä–µ–∑ ${result.minutes} –º–∏–Ω.`);
            } else {
                const attemptsInfo = (result && result.attemptsLeft !== undefined) 
                    ? `\n–û—Å—Ç–∞–ª–æ—Å—å –ø–æ–ø—ã—Ç–æ–∫: ${result.attemptsLeft}` 
                    : "";
                alert("–û—à–∏–±–∫–∞! –ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å." + attemptsInfo);
            }
        }

        function toggleAuthMode(event) {
            event.preventDefault();
            isRegisterMode = !isRegisterMode;

            const modalTitle = document.getElementById('modal-title');
            const modalDesc = document.getElementById('modal-desc');
            const nameInput = document.getElementById('name');
            const passConfirmInput = document.getElementById('password-confirm');
            const loginBtn = document.getElementById('login-btn');
            const registerBtn = document.getElementById('register-btn');
            const toggleLink = document.getElementById('auth-mode-toggle');
            const specialistFields = document.getElementById('specialist-fields');
            const consentFields = document.getElementById('consent-fields');
            const oauthSection = document.getElementById('oauth-section');

            if (isRegisterMode) {
                modalTitle.innerText = currentRole === 'admin' ? "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ü–†–û–§–ò" : "–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ö–õ–ò–ï–ù–¢–ê";
                modalDesc.classList.remove('hidden');
                nameInput.classList.remove('hidden');
                passConfirmInput.classList.remove('hidden');
                loginBtn.classList.add('hidden');
                registerBtn.classList.remove('hidden');
                registerBtn.innerText = (currentRole === 'admin') ? '–î–∞–ª–µ–µ' : '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è';
                registerBtn.onclick = handleRegistrationAttempt;
                oauthSection.classList.add('hidden');
                toggleLink.innerText = '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏';
                if (currentRole === 'admin') specialistFields.classList.remove('hidden');
                consentFields.classList.remove('hidden');
                checkConsents();
            } else {
                modalTitle.innerText = currentRole === 'admin' ? "–í—Ö–æ–¥ –¥–ª—è –ü–†–û–§–ò" : "–í—Ö–æ–¥ –¥–ª—è –ö–õ–ò–ï–ù–¢–ê";
                modalDesc.classList.remove('hidden');
                nameInput.classList.add('hidden');
                passConfirmInput.classList.add('hidden');
                loginBtn.classList.remove('hidden');
                registerBtn.classList.add('hidden');
                oauthSection.classList.remove('hidden');
                toggleLink.innerText = '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è';
                specialistFields.classList.add('hidden');
                consentFields.classList.add('hidden');
            }
        }

        function handleRegistrationAttempt() {
            const name = document.getElementById('name').value.trim();
            const email = document.getElementById('email').value.trim();
            const pass = document.getElementById('password').value.trim();
            const confirmPass = document.getElementById('password-confirm').value.trim();

            if (!name || !email || !pass) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è.');
                return;
            }
            if (pass.length < 10) {
                alert('–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: –ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ 10 —Å–∏–º–≤–æ–ª–æ–≤.');
                return;
            }
            if (pass !== confirmPass) {
                alert('–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç.');
                return;
            }
            
            const consents = {
                termsAccepted: document.getElementById('terms-consent').checked, 
                dataProcessingAccepted: document.getElementById('data-consent').checked, 
                timestamp: Date.now() 
            };

            if (currentRole === 'admin') {
                const spec = document.getElementById('specialization').value.trim();
                const profileData = {
                    fullName: name,
                    onboardingComplete: false,
                    specializations: spec ? [spec] : [],
                    bio: document.getElementById('bio').value.trim(),
                    welcomeMessage: document.getElementById('welcomeMessage').value.trim()
                };

                tempRegistrationData = { role: currentRole, name, email, pass, profileData, consents };

                // Switch to onboarding wizard UI
                document.getElementById('modal-title').innerText = '–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è';
                document.getElementById('modal-desc').classList.add('hidden');
                document.getElementById('auth-step-form').classList.add('hidden');
                document.getElementById('auth-step-onboarding').classList.remove('hidden');
                document.getElementById('auth-mode-toggle').classList.add('hidden');
                document.querySelector('.mt-8.flex.gap-4').classList.add('hidden');

                document.getElementById('wizard-fullName').value = name;
                document.getElementById('wizard-specializations').value = profileData.specializations.join(', ');
                document.getElementById('wizard-bio').value = profileData.bio;

                currentWizardStep = 1;
                renderWizardStep();
            } else {
                // Direct registration for client
                const newUser = MockAPI.registerUser('client', name, email, pass, { fullName: name, onboardingComplete: true }, consents);
                if (newUser && !newUser.error) {
                    const loginResult = MockAPI.loginUser(email, pass);
                    if (loginResult && !loginResult.error) {
                        window.location.href = 'cabinet.html';
                    } else {
                        alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
                        closeAuth();
                        setTimeout(() => openAuth('client'), 300);
                    }
                } else {
                    alert(newUser.error === 'email_taken' ? '–≠—Ç–æ—Ç Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω.' : '–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏.');
                }
            }
        }

        function finalRegister(skipped = false, event) {
            if (event) event.preventDefault();

            let finalProfileData = tempRegistrationData.profileData;

            if (!skipped) {
                finalProfileData.fullName = document.getElementById('wizard-fullName').value;
                finalProfileData.specializations = document.getElementById('wizard-specializations').value.split(',').map(s => s.trim()).filter(Boolean);
                finalProfileData.bio = document.getElementById('wizard-bio').value;
            }

            finalProfileData.onboardingComplete = true;

            const newUser = MockAPI.registerUser(
                tempRegistrationData.role,
                tempRegistrationData.name,
                tempRegistrationData.email,
                tempRegistrationData.pass,
                finalProfileData,
                tempRegistrationData.consents
            );

            if (newUser && !newUser.error) {
                const loginResult = MockAPI.loginUser(tempRegistrationData.email, tempRegistrationData.pass);
                if (loginResult && !loginResult.error) {
                    window.location.href = 'admin.html';
                } else {
                    alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É.');
                    closeAuth();
                    setTimeout(() => openAuth(tempRegistrationData.role), 300);
                }
            } else if (newUser && newUser.error === 'email_taken') {
                alert('–≠—Ç–æ—Ç Email —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ —Å–∏—Å—Ç–µ–º–µ.');
                document.getElementById('auth-step-onboarding').classList.add('hidden');
                document.getElementById('auth-step-form').classList.remove('hidden');
                document.querySelector('.mt-8.flex.gap-4').classList.remove('hidden');
            } else {
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
            }
        }

        // --- Wizard Logic (moved from admin.html) ---
        const totalWizardSteps = 4;
        function renderWizardStep() {
            document.querySelectorAll('.wizard-step-pane').forEach(pane => pane.classList.add('hidden'));
            document.getElementById(`wizard-step-${currentWizardStep}`).classList.remove('hidden');
            document.getElementById('wizard-step-indicator').innerText = `–®–∞–≥ ${currentWizardStep} –∏–∑ ${totalWizardSteps}`;
            const titles = ["–í–∞—à –ü—Ä–æ—Ñ–∏–ª—å", "–í–∞—à–µ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ü–ª–∞—Ç–µ–∂–µ–π", "–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ"];
            document.getElementById('wizard-title').innerText = titles[currentWizardStep - 1];
            const prevBtn = document.getElementById('wizard-prev-btn');
            const nextBtn = document.getElementById('wizard-next-btn');
            prevBtn.style.visibility = currentWizardStep === 1 ? 'hidden' : 'visible';
            nextBtn.innerText = currentWizardStep === totalWizardSteps ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ';
        }

        function navigateWizard(direction) {
            const newStep = currentWizardStep + direction;
            if (newStep > 0 && newStep <= totalWizardSteps) {
                currentWizardStep = newStep;
                renderWizardStep();
            } else if (newStep > totalWizardSteps) {
                finalRegister(false);
            }
        }

        function logout() {
            MockAPI.logoutUser();
            window.location.reload();
        }

        document.addEventListener('DOMContentLoaded', () => {
            MockAPI.init();
            checkAuth();
        });
    </script>
</body>
</html>